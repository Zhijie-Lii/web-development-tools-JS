(this["webpackJsonpweb-chat"]=this["webpackJsonpweb-chat"]||[]).push([[0],{12:function(e,n,t){},34:function(e,n,t){},35:function(e,n,t){"use strict";t.r(n);var c=t(1),r=t.n(c),s=t(6),i=t.n(s),o=(t(12),t(4)),a=t(3),j=function(){return fetch("/api/session",{method:"GET"}).catch((function(){return Promise.reject({error:"network-error"})})).then((function(e){return e.ok?e.json():e.json().then((function(e){return Promise.reject(e)}))}))},u={DEFAULT:"Oh no! Something went wrong, please try again",USERNAME_REQUIRED:"Username is required",NETWORK_ERROR:"There was a problem reaching your network, please try again",LOGIN_REQUIRED:"You must be logged in to view this content",LOGIN_UNAUTHORIZED:"You are not permitted to view this content"},h=t(0),l=function(e){var n=e.user,t=e.username,c=e.onUserInfo,r=e.onChatPage,s=e.onTheme,i=e.onLogout;return n.isLoggedIn?Object(h.jsx)("div",{className:"nav",children:Object(h.jsxs)("ul",{className:"nav-link",children:[Object(h.jsx)("li",{children:Object(h.jsx)("a",{href:"#user-info",onClick:c,children:"Info"})}),Object(h.jsx)("li",{children:Object(h.jsx)("a",{href:"#chat-page",onClick:r,children:"chat-page"})}),Object(h.jsxs)("li",{children:['"Username": ',t]}),Object(h.jsx)("li",{children:Object(h.jsx)("button",{className:!0,onClick:s,children:"Change Theme"})}),Object(h.jsx)("li",{className:"logout",children:Object(h.jsx)("a",{href:"#logout",onClick:i,children:"Logout"})})]})}):null},d=function(e){var n=e.userList,t=e.messageList;e.userInfo;console.log("display: "+n);var c=n.map((function(e){return Object(h.jsx)("span",{children:e})})),r=t.map((function(e){return Object(h.jsxs)("li",{children:[Object(h.jsx)("img",{src:"./avatar_girl1.jpg",width:"15px",height:"18px",alt:"girl"}),Object(h.jsx)("span",{className:"sender",children:e.sender},e.sender),Object(h.jsx)("span",{className:"time-stamp",children:e.timeStamp},e.timeStamp),Object(h.jsx)("br",{}),Object(h.jsx)("span",{className:"text",children:e.text},e.text)]})}));return Object(h.jsxs)("div",{className:"chat-page",children:[Object(h.jsxs)("div",{className:"chat-header",children:["Group chat:  Jennie, Deepika, Jason, Yao, ",c,","]}),Object(h.jsx)("ul",{children:r})]})},m=function(e){var n=e.username,t=e.theme,r=e.info,s=e.setError,i=Object(c.useState)([]),o=Object(a.a)(i,2),j=o[0],l=o[1],m=Object(c.useState)([]),b=Object(a.a)(m,2),f=b[0],O=b[1],g=Object(c.useState)(""),x=Object(a.a)(g,2),p=x[0],v=x[1];return Object(c.useEffect)((function(){fetch("/api/userList",{method:"GET"}).catch((function(){return Promise.reject({error:"network-error"})})).then((function(e){return e.ok?e.json():e.json().then((function(e){return Promise.reject(e)}))})).then((function(e){return l(e)})).catch((function(e){return s(u[e.code||"DEFAULT"])})),fetch("/api/messageList",{method:"GET"}).catch((function(){return Promise.reject({error:"network-error"})})).then((function(e){return e.ok?e.json():e.json().then((function(e){return Promise.reject(e)}))})).then((function(e){O(e)})).catch((function(e){s(u[e.code||"DEFAULT"])}))}),[]),Object(h.jsxs)("ul",{className:t,children:[Object(h.jsx)(d,{userList:j,messageList:f,userInfo:r}),Object(h.jsx)("p",{className:"error-msg",children:undefined}),Object(h.jsxs)("div",{className:"outgoing",children:[Object(h.jsx)("textarea",{rows:"3",cols:"50",onChange:function(e){return v(e.target.value)},value:p}),Object(h.jsx)("img",{onClick:function(){console.log(p,n),function(e,n){return fetch("/api/messages",{method:"POST",headers:new Headers({"content-type":"application/json"}),body:JSON.stringify({sender:e,text:n,timeStamp:(new Date).toLocaleTimeString()})}).catch((function(){return Promise.reject({error:"network-error"})})).then((function(e){return e.ok?e.json():e.json().then((function(e){return Promise.reject(e)}))}))}(n,p).then((function(e){console.log(e),O(e),v("")})).catch((function(e){s(u[e.code||"DEFAULT"])}))},src:"./send_icon.svg",width:"50px",height:"50px"})]})]})},b=function(e){var n=e.onLogin,t=Object(c.useState)(""),r=Object(a.a)(t,2),s=r[0],i=r[1],o=Object(c.useState)(!0),j=Object(a.a)(o,2),l=j[0],d=j[1],m=Object(c.useState)(!1),b=Object(a.a)(m,2),f=b[0],O=b[1],g=Object(c.useState)(""),x=Object(a.a)(g,2),p=x[0],v=x[1];return Object(h.jsxs)("div",{className:"header",children:[Object(h.jsx)("h1",{children:"Join the webchat room"}),p&&Object(h.jsx)("div",{class:"status",children:p}),Object(h.jsxs)("label",{children:["Username:",Object(h.jsx)("input",{disabled:f,onChange:function(e){i(e.target.value),d(!e.target.value)},value:s})]}),Object(h.jsx)("button",{onClick:function(){O(!0),function(e){var n=e.username;return fetch("/api/session",{method:"POST",headers:new Headers({"content-type":"application/json"}),body:JSON.stringify({username:n})}).catch((function(){return Promise.reject({error:"network-error"})})).then((function(e){return e.ok?e.json():e.json().then((function(e){return Promise.reject(e)}))}))}({username:s}).then((function(e){v(""),O(!1),n({username:s,info:e.info}),console.log(e)})).catch((function(e){v(u[e.code||"DEFAULT"]),O(!1)}))},disabled:l||f,children:f?"...":"Login"})]})},f=function(e){var n=e.userInfo;return console.log(n),Object(h.jsxs)("div",{className:"user-info",children:[Object(h.jsx)("div",{className:"chat-header",children:Object(h.jsx)("p",{children:"User information and setting"})}),Object(h.jsxs)("li",{children:["User image:  ",Object(h.jsx)("img",{src:n.avatar,width:"30px",height:"36px"})]}),Object(h.jsxs)("li",{children:["Nickname: ",n.nickname]}),Object(h.jsxs)("li",{children:["Theme: ",n.theme]}),Object(h.jsxs)("li",{children:["lastActive: ",n.lastActive]})]})},O=t(7),g=t.n(O);t(34);var x=function(){var e=Object(c.useState)({isLoggedIn:!1,isPending:!0}),n=Object(a.a)(e,2),t=n[0],r=n[1],s=Object(c.useState)(""),i=Object(a.a)(s,2),d=i[0],O=i[1],x=Object(c.useState)(!1),p=Object(a.a)(x,2),v=p[0],L=p[1];Object(c.useEffect)((function(){j().then((function(e){r({isLoggedIn:!0,isPending:!1,username:e.username,nickname:e.username,theme:"light",lastActive:Date.now()})})).catch((function(){r({isLoggedIn:!1,isPending:!1})}))}),[]);var k,w=function(){var e="light"===t.theme?"dark":"light";r(Object(o.a)(Object(o.a)({},t),{},{theme:e}))};return t.isPending?Object(h.jsxs)("div",{className:"pending",children:["Waiting for loading...",Object(h.jsx)(g.a,{type:"Circles",color:"#00BFFF",height:30,width:30})]}):(k=t.isLoggedIn?v?Object(h.jsx)(f,{userInfo:t.info}):Object(h.jsx)(m,{username:t.username,theme:t.theme,onTheme:w,info:t.info}):Object(h.jsxs)("div",{children:[Object(h.jsx)(b,{onLogin:function(e){var n=e.username,t=e.info;console.log(t),r({isLoggedIn:!0,isPending:!1,username:n,info:t})}}),Object(h.jsx)(b,{})]}),Object(h.jsxs)("div",{className:"app",children:[Object(h.jsx)(l,{user:t,onTheme:w,username:t.username,onChatPage:function(){L(!1)},onUserInfo:function(){j().then((function(e){r(Object(o.a)(Object(o.a)({},t),{},{nickname:e.username,info:e.info})),L(!0)}))},onLogout:function(){r(Object(o.a)(Object(o.a)({},t),{},{isPending:!0})),fetch("/api/session",{method:"DELETE"}).catch((function(){return Promise.reject({error:"network-error"})})).then((function(e){return e.ok?e.json():e.json().then((function(e){return Promise.reject(e)}))})).then((function(){r({isLoggedIn:!1,isPending:!1})})).catch((function(e){O(u[e.code||"DEFAULT"]),r(Object(o.a)(Object(o.a)({},t),{},{isPending:!1}))}))}}),k,Object(h.jsx)("p",{className:"error-msg",children:d})]}))},p=function(e){e&&e instanceof Function&&t.e(3).then(t.bind(null,36)).then((function(n){var t=n.getCLS,c=n.getFID,r=n.getFCP,s=n.getLCP,i=n.getTTFB;t(e),c(e),r(e),s(e),i(e)}))};i.a.render(Object(h.jsx)(r.a.StrictMode,{children:Object(h.jsx)(x,{})}),document.getElementById("root")),p()}},[[35,1,2]]]);
//# sourceMappingURL=main.ed132926.chunk.js.map